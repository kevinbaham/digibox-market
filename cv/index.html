<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Catalogue CV Pro - DigiBox</title>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
  body { font-family:'Segoe UI',sans-serif; background:#f9fafb; color:#333; padding:20px;}
  .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:20px; max-width:1000px; margin:40px auto;}
  .grid-item { background:white; border-radius:8px; box-shadow:0 0 8px #0002; overflow:hidden; cursor:pointer; transition:.3s;}
  .grid-item img { width:100%; display:block; }
  .grid-item:hover { transform:translateY(-3px); box-shadow:0 6px 12px #0003; }

  .cv-container { max-width:1000px; margin:40px auto; background:white; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,0.06); overflow:hidden;}
  .cv-body { display:flex; flex-wrap:wrap; }
  .sidebar { flex:1; min-width:220px; background:#e0e7ff; padding:20px;}
  .main { flex:2; padding:20px;}
  .sidebar h3, .main h3 { color:#2563eb; margin-top:20px; position:relative;}
  .sidebar h3::after, .main h3::after {
    content: ''; display:block; width:40px; height:3px; background:#2563eb; margin-top:5px; border-radius:2px;
  }
  ul { list-style: none; padding-left:0;}
  .photo img { width:140px; height:140px; border-radius:50%; border:3px solid #2563eb; display:block; margin:auto; cursor:pointer;}
  .info { text-align:center; margin:20px 0;}
  .info p small { display:block; margin-top:4px; font-size:0.9em;}
  .back-link, .pdf-btn, .word-btn {
    display:inline-block; background:#2563eb; color:white;
    padding:10px 20px; border-radius:6px; text-decoration:none;
    font-weight:bold; transition:.3s; cursor:pointer; margin:5px;
  }
  .back-link:hover, .pdf-btn:hover, .word-btn:hover { background:#1e40af;}
  .pdf-btn, .word-btn { position:fixed; bottom:20px; right:20px; z-index:999;}
  .word-btn { right:150px; }

  @media(max-width:700px){
    .cv-body{flex-direction:column;}
    .sidebar, .main {min-width:100%;}
  }
  @media print {
    .no-print { display:none; }
  }
</style>
</head>
<body>

<div id="app">
  <h1 style="text-align:center; margin:30px 0;" class="no-print">📚 Catalogue CV professionnels</h1>
  <div class="grid no-print" id="grid"></div>
</div>

<a class="pdf-btn no-print" onclick="if(checkPayment()) window.print()">📄 Export PDF</a>
<a class="word-btn no-print" onclick="if(checkPayment()) exportWord()">📄 Export Word</a>
<input type="file" id="photoInput" accept="image/*" style="display:none;" onchange="loadPhoto(event)">

<script>
function checkPayment(){
  if(!localStorage.getItem("digibox_paid")){
    alert("Merci d'effectuer le paiement avant de télécharger ou exporter.");
    window.location.href = "../paiement.html"; // <- remonte au dossier parent
    return false;
  }
  return true;
}
// Vérifie si l'utilisateur a payé

const app = document.getElementById('app');
const grid = document.getElementById('grid');

// 📸 Affiche catalogue avec preview ou default
for(let i=1; i<=100; i++) {
  let div = document.createElement('div');
  div.className = 'grid-item';
  let preview = localStorage.getItem("cv-preview-"+i) || "img/default-cv.png";
  div.innerHTML = `<img src="${preview}" alt="CV ${i}">`;
  div.onclick = () => loadCV(i);
  grid.appendChild(div);
}

// 📄 Charge le CV et capture preview
function loadCV(n){
  let colors = ['#2563eb','#16a34a','#e11d48','#7e22ce','#f97316','#0f766e'];
  let color = colors[n % colors.length];
  app.innerHTML = `
    <div class="cv-container">
      <div class="cv-body">
        <div class="sidebar" style="background:${color}22;">
          <div class="photo">
            <img id="profilePic" src="assets/profile-placeholder.jpg" alt="Profil" onclick="document.getElementById('photoInput').click()">
          </div>
          <div class="info">
            <h2 contenteditable="true">Kevin Baham</h2>
            <p contenteditable="true">Développeur Web Full Stack</p>
            <p><small contenteditable="true">🎂 Né le 01/01/1990</small></p>
          </div>
          <h3>📞 Contact</h3>
          <p contenteditable="true">✉️ hello@mail.com<br>📞 +228 99 99 99 99<br>🌐 linkedin.com/in/kevinbaham<br>📍 Lomé, Togo</p>
          <h3>💪 Compétences</h3>
          <ul id="skillsList">
            <li contenteditable="true">React, Vue, Node.js</li>
            <li contenteditable="true">MySQL, MongoDB</li>
            <li contenteditable="true">UX/UI Design</li>
          </ul>
          <button type="button" class="no-print add-skill" onclick="addSkill()" style="
            background:#2563eb; color:white; border:none; padding:8px 14px;
            border-radius:5px; font-weight:bold; margin:5px 0; cursor:pointer;">
            ➕ Ajouter compétence
          </button>
          <h3>🌍 Langues</h3>
          <p contenteditable="true">Français : natif<br>Anglais : courant</p>
          <h3>🎯 Loisirs</h3>
          <p contenteditable="true">Musique, Football, Voyages</p>
        </div>
        <div class="main">
          <h3>🧑‍💻 Profil Professionnel</h3>
          <p contenteditable="true">Développeur passionné, rigoureux et créatif, prêt à rejoindre une entreprise pour des projets ambitieux.</p>
          <h3>🏆 Expériences</h3>
          <ul>
            <li contenteditable="true"><strong>Freelance</strong> - 2020-2024<br>Création de +30 sites web et applications pour PME locales.</li>
            <li contenteditable="true"><strong>Stage CreativeStudio</strong> - 2019<br>Refonte UX/UI de dashboards internes.</li>
          </ul>
          <h3>🎓 Formation</h3>
          <ul>
            <li contenteditable="true">Licence Développement Web - ISMA Lomé (2019)</li>
            <li contenteditable="true">BTS Informatique - CEFOP Kégué (2017)</li>
          </ul>
          <h3>🚀 Disponibilité</h3>
          <p contenteditable="true">Disponible immédiatement, mobilité internationale.</p>
          <div style="margin-top:20px;" class="no-print">
            <a href="#" class="back-link" onclick="location.reload()">← Retour au catalogue</a>
          </div>
        </div>
      </div>
    </div>`;
  setTimeout(() => captureCV(n), 500); // capture après affichage
}

// 📸 capture preview et sauvegarde
function captureCV(id){
  let container = document.querySelector(".cv-container");
  html2canvas(container).then(canvas => {
    let img = canvas.toDataURL("image/png");
    localStorage.setItem("cv-preview-"+id, img);
  });
}

function loadPhoto(event){
  let reader = new FileReader();
  reader.onload = () => {
    let img = document.getElementById('profilePic');
    if(img) img.src = reader.result;
  };
  reader.readAsDataURL(event.target.files[0]);
}

function addSkill(){
  const ul = document.getElementById('skillsList');
  let li = document.createElement('li');
  li.contentEditable = true;
  li.innerText = "Nouvelle compétence";
  ul.appendChild(li);
}

function exportWord(){
  if(!checkPayment()) return;
  alert("Export Word simulé. À intégrer avec FileSaver.js si tu veux.");
}
</script>
</body>
</html>
